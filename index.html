<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Torrent Requests</title>
    <style>
        /* CSS for styling */
        body {
            font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0; /* Light gray background */
            color: #333; /* Blackish text color */
        }
        .title-bar {
            background-color: #333; /* Dark blue title bar */
            color: #fff; /* White text color */
            text-align: center;
            padding: 10px 0;
            font-size: 35px;
        }
        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff; /* White container background */
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    
        }
        .request-item {
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f9f9f9; /* Light gray request item background */
            border-radius: 5px;
            
        }
        .link-item {
            padding: 10px;
            background-color: #f0f0f0; /* Light gray link item background */
            border-radius: 5px;
            margin-bottom: 10px;
            padding: auto;
            
        }
        
    </style>
</head>
<body>
    <div class="title-bar">Common Website</div>
    <div class="container">
        <h2>Request Torrent/Magnet Link</h2>
        <form id="request-form">
            <label for="title">Title:</label><br>
            <input type="text" id="title" name="title" required><br>
            <label for="description">Description (50 words limit):</label><br>
            <textarea id="description" name="description" rows="3" maxlength="50" required><br></textarea><br>
            
            <button type="submit">Submit Request</button>
        </form>
        <hr>
        <h2>Open Requests</h2>
        <div id="open-requests"></div>

        <h2>Submitted Links</h2>
        <div id="submitted-links"></div>
    </div>
    <footer class="footer" style="background-color: #333; color: #fff; text-align: center; padding: 10px;">
        &copy; 2024 Common Website
    </footer>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.3.3/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.3.3/firebase-database.js"></script>

    <script>
        // Initialize Firebase
        var firebaseConfig = {
             apiKey: "AIzaSyDRDPueFbHs8rrZDuq3kCjSevukjRZztro",
             authDomain: "commonwebsite-5e316.firebaseapp.com",
             databaseURL: "https://commonwebsite-5e316-default-rtdb.asia-southeast1.firebasedatabase.app",
             projectId: "commonwebsite-5e316",
             storageBucket: "commonwebsite-5e316.appspot.com",
             messagingSenderId: "138538311145",
             appId: "1:138538311145:web:34d891df8ed4ce16dbbf78"
        };
        firebase.initializeApp(firebaseConfig);

        var database = firebase.database();

        // Function to display open requests
        function displayOpenRequests() {
            database.ref('requests').on('child_added', function(snapshot) {
                var requestData = snapshot.val();
                var requestKey = snapshot.key;

                var requestItem = document.createElement('div');
                requestItem.classList.add('request-item');
                requestItem.innerHTML = '<strong>Title:</strong> ' + requestData.title + '<br><strong>Description:</strong> ' + requestData.description +
                                  
                                        '<form class="reply-form" id="reply-form-' + requestKey + '">' +
                                        '<input type="text" id="link-' + requestKey + '" placeholder="Enter link">' +
                                        '<button type="submit" data-request-key="' + requestKey + '">Submit Link</button>' +
                                        '</form>';

                // Handle reply submission
                requestItem.querySelector('#reply-form-' + requestKey).addEventListener('submit', function(event) {
                    event.preventDefault();
                    var link = document.getElementById('link-' + requestKey).value.trim();

                    if (link !== '') {
                        // Update Firebase with the submitted link and remove the open request
                        var updates = {};
                        updates['/submitted_links/' + requestKey] = {
                            title: requestData.title,
                            description: requestData.description,
                            link: link
                            
                        };
                        updates['/requests/' + requestKey] = null; // Remove the open request
                        firebase.database().ref().update(updates)
                            .then(function() {
                                alert('Reply submitted successfully!');
                            })
                            .catch(function(error) {
                                console.error('Error submitting reply:', error);
                            });
                    } else {
                        alert('Please enter a link.');
                    }
                });

                document.getElementById('open-requests').appendChild(requestItem);
            });
        }

        // Function to display submitted links
        function displaySubmittedLinks() {
            database.ref('submitted_links').on('child_added', function(snapshot) {
                var linkData = snapshot.val();

                var linkItem = document.createElement('div');
                linkItem.classList.add('link-item');
                linkItem.innerHTML = '<strong>Title:</strong> ' + linkData.title + '<br><strong>Description:</strong> ' + 
                                    linkData.description + '<br><strong>Link:</strong> <a href="' + linkData.link + '" onclick="copyLink(\'' + 
                                    linkData.link + '\'); return false;">Click to copy</a>' 
                                     ;


                document.getElementById('submitted-links').appendChild(linkItem);
            });
        }

        // Function to handle form submission for requesting links
        document.getElementById('request-form').addEventListener('submit', function(event) {
            event.preventDefault();

            var title = document.getElementById('title').value.trim();
            var description = document.getElementById('description').value.trim();

            if (title !== '' && description !== '') {
                // Save the request to Firebase
                var newRequestRef = database.ref('requests').push();
                newRequestRef.set({
                    title: title,
                    description: description
                })
                .then(function() {
                    alert('Request submitted successfully!');
                    // Clear form fields after submission
                    document.getElementById('title').value = '';
                    document.getElementById('description').value = '';
                })
                .catch(function(error) {
                    console.error('Error submitting request:', error);
                });
            } else {
                alert('Please fill in all fields.');
            }
        });
        // Function to handle copyLink 
        function copyLink(link) {
    // Copy the link to the clipboard
    navigator.clipboard.writeText(link)
        .then(function() {
            alert('Link copied to clipboard!');
        })
        .catch(function(error) {
            console.error('Error copying link:', error);
        });
}

        // Function to handle like action on a link
       // function likeLink(linkKey) {
         //   var linkRef = database.ref('submitted_links/' + linkKey + '/likes');
          //  linkRef.transaction(function(likes) {
            //    return (likes || 0) + 1;
           // });
       // } 
        

        // Function to handle dislike action on a link
       // function dislikeLink(linkKey) {
         //   var linkRef = database.ref('submitted_links/' + linkKey + '/dislikes');
        //    linkRef.transaction(function(dislikes) {
         //       return (dislikes || 0) + 1;
           // });
       // }

        // Call the functions to display open requests and submitted links
        displayOpenRequests();
        displaySubmittedLinks();
    </script>
</body>
</html>
